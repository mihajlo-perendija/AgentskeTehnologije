(this["webpackJsonpchat-client"]=this["webpackJsonpchat-client"]||[]).push([[0],{25:function(e,t,s){e.exports=s(39)},30:function(e,t,s){},31:function(e,t,s){},36:function(e,t,s){},37:function(e,t,s){},38:function(e,t,s){},39:function(e,t,s){"use strict";s.r(t);var n=s(0),a=s.n(n),r=s(20),i=s.n(r),o=s(24),l=s(4),c=s(5),u=s(7),d=s(6),m=s(10),g=s(9),p=s(21),h=(s(30),s(13)),f=(s(31),function(e){Object(u.a)(s,e);var t=Object(d.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).onChange=function(e){n.setState(Object(h.a)({},e.target.name,e.target.value),n.validateInput)},n.onSubmit=function(e){e.preventDefault(),n.setState({submitted:!0},n.sendRegisterRequest)},n.sendRegisterRequest=function(){n.validateInput((function(){if(n.state.usernameAlertHidden&&n.state.passwordAlertHidden&&n.state.confirmPasswordAlertHidden){var e={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({username:n.state.username,password:n.state.password})};fetch("rest/chat/users/register",e).then((function(e){e.ok?(alert("Successfuly registered"),n.setState({registered:!0})):alert("Username already exists")})).catch((function(e){console.log(e)}))}}))},n.state={username:"",password:"",confirmPassword:"",submitted:!1,usernameAlertHidden:!0,passwordAlertHidden:!0,confirmPasswordAlertHidden:!0,registered:!1},n}return Object(c.a)(s,[{key:"validateInput",value:function(e){this.state.submitted&&this.setState({usernameAlertHidden:this.usernameValid(),passwordAlertHidden:this.passwordValid(),confirmPasswordAlertHidden:this.confirmPasswordValid()},e)}},{key:"usernameValid",value:function(){return this.state.username.length>3}},{key:"passwordValid",value:function(){return this.state.password.length>5}},{key:"confirmPasswordValid",value:function(){return this.state.password===this.state.confirmPassword}},{key:"render",value:function(){return!0===this.state.registered?a.a.createElement(g.a,{to:"/login"}):a.a.createElement("div",null,a.a.createElement("form",{onSubmit:this.onSubmit,id:"register_form"},a.a.createElement("h2",{id:"register_h2"},"Sign Up"),a.a.createElement("p",{className:"register_p"},a.a.createElement("input",{className:"register_input",type:"text",name:"username",placeholder:"Username",value:this.state.username,onChange:this.onChange}),a.a.createElement("span",{className:"register_span",style:{visibility:this.state.usernameAlertHidden?"hidden":"visible"}},"Enter a username longer than 4 characters")),a.a.createElement("p",{className:"register_p"},a.a.createElement("input",{className:"register_input",type:"password",name:"password",placeholder:"Password",value:this.state.password,onChange:this.onChange}),a.a.createElement("span",{className:"register_span",style:{visibility:this.state.passwordAlertHidden?"hidden":"visible"}},"Enter a password longer than 5 characters")),a.a.createElement("p",{className:"register_p"},a.a.createElement("input",{className:"register_input",type:"password",name:"confirmPassword",placeholder:"Confirm password",value:this.state.confirmPassword,onChange:this.onChange}),a.a.createElement("span",{className:"register_span",style:{visibility:this.state.confirmPasswordAlertHidden?"hidden":"visible"}},"Your passwords do not match")),a.a.createElement("p",{className:"register_p"},a.a.createElement("input",{className:"register_input",type:"submit",value:"Create My Account",id:"submit"}))))}}]),s}(n.Component)),v=(s(36),function(e){Object(u.a)(s,e);var t=Object(d.a)(s);function s(e){var n;return Object(l.a)(this,s),(n=t.call(this,e)).onChange=function(e){n.setState(Object(h.a)({},e.target.name,e.target.value),n.validateInput)},n.onSubmit=function(e){e.preventDefault(),n.setState({submitted:!0},n.sendLoginRequest)},n.sendLoginRequest=function(){n.validateInput((function(){if(n.state.usernameAlertHidden&&n.state.passwordAlertHidden){var e={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({username:n.state.username,password:n.state.password})};fetch("rest/chat/users/login",e).then((function(e){if(e.ok)return alert("Successfuly logged in"),e.json();alert("Invalid username or password")})).then((function(e){(null===e||void 0===e?void 0:e.username)&&(n.props.setLoggedInUser(e),n.props.history.push("/chat"))})).catch((function(e){console.log(e)}))}}))},n.state={username:"",password:"",submitted:!1,usernameAlertHidden:!0,passwordAlertHidden:!0},n}return Object(c.a)(s,[{key:"validateInput",value:function(e){this.state.submitted&&this.setState({usernameAlertHidden:this.usernameValid(),passwordAlertHidden:this.passwordValid()},e)}},{key:"usernameValid",value:function(){return this.state.username.length>3}},{key:"passwordValid",value:function(){return this.state.password.length>5}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("form",{onSubmit:this.onSubmit,id:"login_form"},a.a.createElement("h2",{id:"login_h2"},"Sign In"),a.a.createElement("p",{className:"login_p"},a.a.createElement("input",{className:"login_input",type:"text",name:"username",placeholder:"Username",value:this.state.username,onChange:this.onChange}),a.a.createElement("span",{className:"login_span",style:{visibility:this.state.usernameAlertHidden?"hidden":"visible"}},"Invalid username")),a.a.createElement("p",{className:"login_p"},a.a.createElement("input",{className:"login_input",type:"password",name:"password",placeholder:"Password",value:this.state.password,onChange:this.onChange}),a.a.createElement("span",{className:"login_span",style:{visibility:this.state.passwordAlertHidden?"hidden":"visible"}},"Invalid password")),a.a.createElement("p",{className:"login_p"},a.a.createElement("input",{className:"login_input",type:"submit",value:"Sign In",id:"submit"})),a.a.createElement("div",{id:"route_to_register_div"},a.a.createElement("h2",null,"Don't have an account? ",a.a.createElement(m.b,{to:"/register"},"Register"),"  "))))}}]),s}(n.Component)),b=Object(g.f)(v),E=(s(37),function(e){Object(u.a)(s,e);var t=Object(d.a)(s);function s(){var e;Object(l.a)(this,s);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).getConversationClass=function(t){var s;return t.username===(null===(s=e.props.selectedUser)||void 0===s?void 0:s.username)?"conversation active":"conversation"},e}return Object(c.a)(s,[{key:"render",value:function(){var e=this;return 0===this.props.users.length?null:this.props.users.map((function(t){return a.a.createElement("div",{className:e.getConversationClass(t),key:t.id,onClick:e.props.selectConversation.bind(e,t)},a.a.createElement("div",{className:"title-text"},t.username),a.a.createElement("div",{className:"created-date"}),a.a.createElement("div",{className:"conversation-message"}))}))}}]),s}(n.Component)),w=(s(38),function(e){Object(u.a)(s,e);var t=Object(d.a)(s);function s(){var e;Object(l.a)(this,s);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).getMessageClass=function(t){return t.sender===e.props.loggedInUser.username?"message-row my-message":"message-row other-message"},e}return Object(c.a)(s,[{key:"render",value:function(){var e=this;return this.props.messages?this.props.messages.slice(0).reverse().map((function(t){return a.a.createElement("div",{className:e.getMessageClass(t),key:new Date(t.timeStamp).getTime()},a.a.createElement("div",{className:"message-text"},t.text),a.a.createElement("div",null,a.a.createElement("span",{className:"message-username"},t.sender+" at "),a.a.createElement("span",{className:"message-time"},new Date(t.timeStamp).toLocaleString())))})):null}}]),s}(n.Component)),y=function(e){Object(u.a)(s,e);var t=Object(d.a)(s);function s(){var e;Object(l.a)(this,s);for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).state={loggedInUser:null,users:[],selectedUser:{},text:"",visibleMessages:[]},e.selectConversation=function(t){e.setState({selectedUser:t,text:""},e.getConversationMessages)},e.getConversationMessages=function(){var t;t="ALL"===e.state.selectedUser.username?e.state.loggedInUser.messages.filter((function(e){return"ALL"===e.receiver})):e.state.loggedInUser.messages.filter((function(t){return t.sender===e.state.selectedUser.username&&t.receiver===e.state.loggedInUser.username||t.sender===e.state.loggedInUser.username&&t.receiver===e.state.selectedUser.username})),e.setState({visibleMessages:t})},e.getUserMessages=function(){var t="rest/chat/messages/".concat(e.state.loggedInUser.username);fetch(t,{method:"GET"}).then((function(e){if(e.ok)return e.json();alert("Error")})).then((function(t){t||(t=[]);var s=e.state.loggedInUser;s.messages=t,e.setState({loggedInUser:s,text:""})})).catch((function(e){console.log(e)}))},e.getAllDataOnLogin=function(){e.getUserMessages(),e.getOnlineUsers();var t,s=window.location;t="https:"===s.protocol?"wss:":"ws:",t+="//"+s.host,t+=s.pathname+"ws/",console.log(t);var n=t;e.websocket=new WebSocket(n+e.state.loggedInUser.username),e.websocket.onopen=function(){console.log("connected")},e.websocket.onmessage=function(t){var s=JSON.parse(t.data);if(void 0!==s.text){var n=s,a=[].concat(Object(o.a)(e.state.loggedInUser.messages),[n]),r=e.state.loggedInUser;r.messages=a,e.setState({loggedInUser:r,text:""},e.getConversationMessages)}else e.setState({users:s.filter((function(t){return t.username!==e.state.loggedInUser.username}))})},e.websocket.onclose=function(){console.log("disconnected"),e.setState({websocket:new WebSocket(n+e.state.loggedInUser.username)})}},e.setLoggedInUser=function(t){e.setState({loggedInUser:t},(function(){e.getAllDataOnLogin()}))},e.logout=function(){var t="rest/chat/users/loggedIn/".concat(e.state.loggedInUser.username);fetch(t,{method:"DELETE",headers:{"content-type":"application/json"}}).then((function(t){t.ok?e.setState({loggedInUser:null,selectedUser:null,users:[]}):alert("Error")})).catch((function(e){console.log(e)}))},e.getOnlineUsers=function(){fetch("rest/chat/users/loggedIn").then((function(e){if(e.ok)return e.json();alert("Error")})).then((function(t){e.setState({users:t.filter((function(t){return t.username!==e.state.loggedInUser.username}))})})).catch((function(e){console.log(e)}))},e.getAllUsers=function(){fetch("rest/chat/users/registered").then((function(e){if(e.ok)return e.json();alert("Error")})).then((function(t){e.setState({users:t.filter((function(t){return t.username!==e.state.loggedInUser.username}))})})).catch((function(e){console.log(e)}))},e.onMessageChange=function(t){e.setState({text:t.target.value})},e.onSendMessage=function(t){if(t.preventDefault(),e.state.loggedInUser){var s;s="ALL"===e.state.selectedUser.username?"all":"user";var n={sender:e.state.loggedInUser.username,receiver:e.state.selectedUser.username,text:e.state.text,timeStamp:(new Date).getTime()},a={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(n)},r="rest/chat/messages/".concat(s);fetch(r,a).then((function(e){e.ok||alert("Error")})).catch((function(e){console.log(e)}))}},e.changeToAll=function(){e.setState({selectedUser:{username:"ALL"},text:""},e.getConversationMessages)},e}return Object(c.a)(s,[{key:"render",value:function(){var e=this;return a.a.createElement(m.a,{basename:"/"},a.a.createElement("div",{className:"App"},a.a.createElement(g.b,{exact:!0,path:"/",render:function(t){return a.a.createElement(a.a.Fragment,null,a.a.createElement(b,{setLoggedInUser:e.setLoggedInUser}))}}),a.a.createElement(g.b,{exact:!0,path:"/login",render:function(t){return a.a.createElement(a.a.Fragment,null,a.a.createElement(b,{setLoggedInUser:e.setLoggedInUser}))}}),a.a.createElement(g.b,{exact:!0,path:"/register",render:function(e){return a.a.createElement(a.a.Fragment,null,a.a.createElement(f,null))}}),a.a.createElement(g.b,{exact:!0,path:"/chat",render:function(t){var s,n;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{id:"chat-container"},a.a.createElement("div",{id:"search-container"},null!==e.state.loggedInUser?a.a.createElement("div",{className:"buttons-div"},a.a.createElement("button",{className:"users-button",onClick:e.getOnlineUsers},"Online"),a.a.createElement("button",{className:"users-button",style:{marginLeft:"20px"},onClick:e.getAllUsers},"All")):null),a.a.createElement("div",{id:"conversation-list"},a.a.createElement(E,{users:e.state.users,selectConversation:e.selectConversation,selectedUser:e.state.selectedUser})),a.a.createElement("div",{id:"lower-left-container"},null===e.state.loggedInUser?a.a.createElement("div",{className:"buttons-div"},a.a.createElement(m.b,{className:"button-link",to:"/login"},"Login"),a.a.createElement(m.b,{className:"button-link",style:{marginLeft:"20px"},to:"/register"},"Sign up")):a.a.createElement("div",{className:"buttons-div"},a.a.createElement("button",{className:"users-button",onClick:e.logout},"Logout"),"ALL"!==(null===(s=e.state.selectedUser)||void 0===s?void 0:s.username)?a.a.createElement("button",{className:"users-button",style:{marginLeft:"20px",width:"120px"},onClick:e.changeToAll},"Send to all"):null)),a.a.createElement("div",{id:"chat-title"},a.a.createElement("span",null,null===(n=e.state.selectedUser)||void 0===n?void 0:n.username)),a.a.createElement("div",{id:"chat-message-list"},null!=e.state.loggedInUser&&e.state.selectedUser?a.a.createElement(w,{messages:e.state.visibleMessages,user:e.state.selectedUser,loggedInUser:e.state.loggedInUser}):null),a.a.createElement("form",{id:"chat-form",onSubmit:e.onSendMessage},a.a.createElement("div",null,a.a.createElement("input",{type:"text",value:e.state.text,placeholder:"type a message",onChange:e.onMessageChange,style:{width:"80%"}}),a.a.createElement("input",{type:"submit",value:"Send"})))))}})),a.a.createElement(p.a,{name:"main-component",data:this.state,debounce:500,onMount:function(t){return e.setState(t)}}))}}]),s}(n.Component);i.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(y,null)),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.661d1b16.chunk.js.map